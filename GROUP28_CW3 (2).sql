-- MySQL script
CREATE DATABASE  IF NOT EXISTS `ecs519uCW3`;
USE `ecs519uCW3`;
select 'Building demonstration tables.  Please wait.' as '';

DROP TABLE IF EXISTS ROUTE;
DROP TABLE IF EXISTS STOP;
DROP TABLE IF EXISTS TRAIN;
DROP TABLE IF EXISTS PASSENGER;
DROP TABLE IF EXISTS CREW;
DROP TABLE IF EXISTS CREW;

CREATE TABLE ROUTE
       (ID SMALLINT NOT NULL PRIMARY KEY,
        STARTSTATION varchar(255),
        TERMINALSTATION varchar(255),
        DISTANCE SMALLINT NOT NULL,
        JOURNEYTIME TINYINT,
        ISOLD BOOL,
        STATUS VARCHAR(20));

INSERT INTO ROUTE VALUES
        (7369, 'LONDON ST PANCRAS', 'PARIS',470,
        2,  1, 'PLANNING');
INSERT INTO ROUTE VALUES
        (7379, 'LONDON STRATFORD',  'PARIS',301,
        3,  0, 'OPERATIONAL');
INSERT INTO ROUTE VALUES
        (7331, 'LONDON STRATFORD',  'COLOGNE',375,
        5,  0, 'SOON');
INSERT INTO ROUTE VALUES
        (7342, 'LONDON ST PANCRAS',  'BRUSSELS',234,
        2,  1, 'SOON');
INSERT INTO ROUTE VALUES
        (7388, 'LONDON STRATFORD',  'BRUSSELS',225,
        2,  0, 'PLANNING');
INSERT INTO ROUTE VALUES
        (7729, 'LONDON VICTORIA STATION',  'DISNEYLAND PARIS',329,
        5,  1, 'SOON');
INSERT INTO ROUTE VALUES
        (7310, 'LONDON ST PANCRAS',  'LILLE',171,
        3,  1, 'PLANNING');
INSERT INTO ROUTE VALUES
        (7309, 'LONDON STRATFORD',  'ROTTERDAM',293,
        3,  0, 'SOON');
INSERT INTO ROUTE VALUES
        (7355, 'LONDON ST PANCRAS',  'ROTTERDAM',293,
        3,  1, 'OPERATIONAL');
INSERT INTO ROUTE VALUES
        (7328, 'LONDON ST PANCRAS',  'BRUGES',178,
        3,  1, 'PLANNING');

CREATE TABLE STOP
       (NAME VARCHAR(10) PRIMARY KEY);

INSERT INTO STOP VALUES
        ('PARIS');
INSERT INTO STOP VALUES
        ('COLOGNE');
INSERT INTO STOP VALUES
        ('BRUSSELS');
INSERT INTO STOP VALUES
        ('DISNEYLAND PARIS');
INSERT INTO STOP VALUES
        ('LILLE');
INSERT INTO STOP VALUES
        ('BRUGES');
INSERT INTO STOP VALUES
        ('ROTTERDAM');
INSERT INTO STOP VALUES
        ('LYON');
INSERT INTO STOP VALUES
        ('GHENT');
INSERT INTO STOP VALUES
        ('TOULON');
INSERT INTO STOP VALUES
        ('CALAIS');
INSERT INTO STOP VALUES
        ('BORDEAUX');

CREATE TABLE TRAIN
       (ID SMALLINT NOT NULL,
        STARTPOINT VARCHAR(30),
        ENDPOINT VARCHAR(30),
        FABRICATIONDATE DATE NOT NULL,
        ISOPERATIONAL BOOL);

INSERT INTO TRAIN VALUES
        (7369, 'LONDON ST PANCRAS', 'PARIS','2010-11-01',
        0);
INSERT INTO TRAIN VALUES
        (7379, 'LONDON STRATFORD',  'PARIS','2019-02-20',
        1);
INSERT INTO TRAIN VALUES
        (7331, 'LONDON STRATFORD',  'COLOGNE','2019-02-20',
        1);
INSERT INTO TRAIN VALUES
        (7342, 'LONDON ST PANCRAS',  'BRUGES','2010-11-01',
        0);
INSERT INTO TRAIN VALUES
        (7369, 'LONDON ST PANCRAS', 'PARIS','2010-12-27',
        0);
INSERT INTO TRAIN VALUES
        (7379, 'LONDON STRATFORD',  'PARIS','2020-05-19',
        1);
INSERT INTO TRAIN VALUES
        (7331, 'LONDON STRATFORD',  'COLOGNE','2019-07-04',
        1);
INSERT INTO TRAIN VALUES
        (7342, 'LONDON ST PANCRAS',  'BRUSSELS','2009-05-21',
        0);
INSERT INTO TRAIN VALUES
        (7331, 'LONDON STRATFORD',  'COLOGNE','2019-02-07',
        1);
INSERT INTO TRAIN VALUES
        (7342, 'LONDON ST PANCRAS',  'BRUSSELS','2010-11-08',
        1);


CREATE TABLE PASSENGER
       (NIN VARCHAR(9) NOT NULL,
        FIRSTNAME VARCHAR(10),
        LASTNAME VARCHAR(9),
        TYPE VARCHAR(9),
	PRIMARY KEY (NIN));

INSERT INTO PASSENGER VALUES
        ('QQ123456C', 'LISA', 'ANDREW','ADULT');
INSERT INTO PASSENGER VALUES
        ('AB276596J', 'AHMAD', 'OYEN','ADULT');
INSERT INTO PASSENGER VALUES
        ('XQ897654P', 'HITAM', 'KAI','SENIOR');
INSERT INTO PASSENGER VALUES
        ('JJ889062K', 'JUS', 'TINA','STUDENT');
INSERT INTO PASSENGER VALUES
        ('YH653081Y', 'ZAKWAN', 'SAM','STUDENT');
INSERT INTO PASSENGER VALUES
        ('MM762082Q', 'CODY', 'MAN','SENIOR');
INSERT INTO PASSENGER VALUES
        ('JM616178O', 'SUSU', 'DANI','PUPIL');
INSERT INTO PASSENGER VALUES
        ('HG711763S', 'DREW', 'CHAPALOT','ADULT');
INSERT INTO PASSENGER VALUES
        ('NQ099712R', 'SIKAR', 'ARASH','ADULT');
INSERT INTO PASSENGER VALUES
        ('WZ822361V', 'JACK', 'SITI','ADULT');


CREATE TABLE CREW
       (CREWHEADID INT NOT NULL PRIMARY KEY);

INSERT INTO CREW VALUES
        (68319);
INSERT INTO CREW VALUES
        (65407);
INSERT INTO CREW VALUES
        (67832);
INSERT INTO CREW VALUES
        (65646);
INSERT INTO CREW VALUES
        (61290);
INSERT INTO CREW VALUES
        (69324);
INSERT INTO CREW VALUES
        (64312);
INSERT INTO CREW VALUES
        (60019);
INSERT INTO CREW VALUES
        (68182);
INSERT INTO CREW VALUES
        (67112);
INSERT INTO CREW VALUES
        (68992);
INSERT INTO CREW VALUES
        (67231);
INSERT INTO CREW VALUES
        (64533);
INSERT INTO CREW VALUES
        (68002);
INSERT INTO CREW VALUES
        (68771);

CREATE TABLE EMPLOYEE
       (ID INT NOT NULL,
        FIRSTNAME VARCHAR(10),
        LASTNAME VARCHAR(10),
        ROLE VARCHAR(10),
	PRIMARY KEY (ID));

INSERT INTO EMPLOYEE VALUES
        (68319, 'ZIZI', 'BAPAK','DRIVER');
INSERT INTO EMPLOYEE VALUES
        (65407, 'NOOR', 'RAHMAT','CONDUCTOR');
INSERT INTO EMPLOYEE VALUES
        (67832, 'SHASHA', 'CARROT','CONDUCTOR');
INSERT INTO EMPLOYEE VALUES
        (65646, 'ANUSTAN', 'WANG','MEMBER');
INSERT INTO EMPLOYEE VALUES
        (61290, 'AMY', 'JAHAD','SALES');
INSERT INTO EMPLOYEE VALUES
        (69324, 'EDWARD', 'FIKRI','SECURITY');
INSERT INTO EMPLOYEE VALUES
        (64312, 'ALVIS', 'CIKU','MANAGEMENT');
INSERT INTO EMPLOYEE VALUES
        (60019, 'CAMERON', 'DIAZ','MEMBER');
INSERT INTO EMPLOYEE VALUES
        (68182, 'ALKE', 'ROAK','DRIVER');
INSERT INTO EMPLOYEE VALUES
        (67112, 'MARY', 'SHOCKE','MEMBER');
INSERT INTO EMPLOYEE VALUES
        (68992, 'JET', 'CAM','MEMBER');
INSERT INTO EMPLOYEE VALUES
        (67231, 'CHAM', 'LI','MEMBER');
INSERT INTO EMPLOYEE VALUES
        (64533, 'ROCK', 'AMBER','SECURITY');
INSERT INTO EMPLOYEE VALUES
        (68002, 'RICKY', 'MATTHEW','MECHANIC');
INSERT INTO EMPLOYEE VALUES
        (68771, 'JANET', 'KIM','SALES');

COMMIT;

select 'PROMPT Demonstration table build is complete.' as '';

-- BASIC QUERY 1 : DISPLAY ALL THE TERMINAL STATIONS TO PARIS.
SELECT * FROM route WHERE TERMINALSTATION='PARIS';

-- BASIC QUERY 1 : Select the trains that are allowed operate on new routes, which is fabrication date more than 2016-01-01
SELECT * FROM TRAIN WHERE FABRICATIONDATE>='2016-01-01';

-- MEDIUM QUERY 1 : LIST EACH ROLE AND HOW MANY EMPLOYEES ARE THERE.
SELECT ROLE, COUNT(ROLE) FROM EMPLOYEE
GROUP BY ROLE;

-- MEDIUM QUERY 2 : COUNT THE TYPES OF PASSENGERS
SELECT COUNT(NIN), TYPE FROM PASSENGER GROUP BY TYPE;

-- MEDIUM QUERY 3 
SELECT A.FIRSTNAME AS FIRSTNAME1, B.FIRSTNAME AS FIRSTNAME2, A.TYPE
FROM PASSENGER A, PASSENGER B
WHERE A.TYPE = B.TYPE
ORDER BY A.TYPE;


-- ADVANCED QUERY 1 : FIND THE FURTHEST ROUTE 
SELECT ID, TERMINALSTATION, DISTANCE FROM ROUTE 
WHERE DISTANCE in(SELECT max(DISTANCE) from ROUTE);

-- ADVANCED QUERY 2 
SELECT STARTSTATION, TERMINALSTATION FROM ROUTE WHERE EXISTS(SELECT * FROM STOP WHERE TERMINALSTATION = NAME); 

-- ADVANCED QUERY 3: LIST THE DRIVERS 
SELECT CREWHEADID FROM CREW WHERE EXISTS 
(SELECT ID FROM EMPLOYEE 
WHERE CREW.CREWHEADID = EMPLOYEE.ID AND ROLE='DRIVER');

DROP TABLE ROUTE;
DROP TABLE STOP;
DROP TABLE TRAIN;
DROP TABLE PASSENGER;
DROP TABLE CREW;
DROP TABLE EMPLOYEE;